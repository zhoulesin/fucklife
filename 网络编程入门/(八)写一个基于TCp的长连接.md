# 基于TCP的长连接

## TCP/IP协议简介

### IP协议

IP协议提供了主机和主机间的通信

为了完成不同主机的通信,我们需要某种方式来唯一标识一台主机,这个标识,就是著名的IP地址.通过IP地址,ip协议就能够帮我们把一个数据包发送给对方

### TCP协议

IP协议提供了主机和主机间的通信.TCP协议在IP协议提供的主机间通信功能的基础上,完成这两个主机上进程对进程的通信.

有了IP,不同主机就能够交换数据.但是,计算机收到数据后,并不知道这个数据属于哪个进程.TCP的作用就在于,让我们能够知道这个数据属于哪个进程,从而完成进程间的通信.

为了标识数据属于哪个进程,我们给需要进行TCP通信的进程分配一个唯一的数字来标识它.这个数字,就是我们常说的端口号.

TCP的全称Transmission Control Protocol,大家对他说的最多的是,大概就是面向连接的特性了.之所以说它是有连接的,是说在进行通信前,通信双方需要先经过一个三次握手的过程.三次握手完成后,连接变建立了.这时候我们才可以开始发送/接收数据.

- 首先,客户端向服务端发送一个SYN,假设此时sequence number为x.这个x是由操作系统根据一定的规则生成的,不妨认为他是一个随机数
- 服务端收到SYN后,会向客户端在发送一个SYN,此时服务器的seq number为y,与此同时,回arc x+1,告诉客户端已经收到SYN,可以发送数据了
- 客户端收到服务器的SYn后,回复一个ack y+1,这个ack则是告诉服务器,SYN已经收到了,服务器可以发送数据了.

经过这3步,TCP连接就建立了,这里需要注意的又三点:

- 连接是由客户端主动发起的
- 在第3步客户端向服务器回复ACK的时候,TCP协议时允许我们携带数据的.之所以做不到,是API的限制导致的
- TCP协议还允许四次握手的发生,同样的,由于API限制,这个极端的情况并不会发生